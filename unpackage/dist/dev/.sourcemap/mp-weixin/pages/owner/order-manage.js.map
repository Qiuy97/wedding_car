{"version":3,"file":"order-manage.js","sources":["pages/owner/order-manage.uvue","pages/owner/order-manage.uvue?type=page"],"sourcesContent":["<template>\n  <view class=\"order-manage-page\">\n    <!-- 状态标签 -->\n    <scroll-view class=\"status-tabs\" scroll-x>\n      <view class=\"tabs-container\">\n        <view class=\"tab-item\" \n              :class=\"{ active: activeTab === 'all' }\"\n              @click=\"switchTab('all')\">\n          全部\n        </view>\n        <view class=\"tab-item\" \n              :class=\"{ active: activeTab === 'pending' }\"\n              @click=\"switchTab('pending')\">\n          待确认\n          <view class=\"tab-badge\" v-if=\"pendingCount > 0\">{{ pendingCount }}</view>\n        </view>\n        <view class=\"tab-item\" \n              :class=\"{ active: activeTab === 'confirmed' }\"\n              @click=\"switchTab('confirmed')\">\n          已确认\n        </view>\n        <view class=\"tab-item\" \n              :class=\"{ active: activeTab === 'ongoing' }\"\n              @click=\"switchTab('ongoing')\">\n          进行中\n        </view>\n        <view class=\"tab-item\" \n              :class=\"{ active: activeTab === 'completed' }\"\n              @click=\"switchTab('completed')\">\n          已完成\n        </view>\n      </view>\n    </scroll-view>\n\n    <!-- 订单列表 -->\n    <scroll-view class=\"order-list\" scroll-y @scrolltolower=\"loadMore\">\n      <view class=\"order-item\" \n            v-for=\"order in orderList\" \n            :key=\"order._id\"\n            @click=\"goToOrderDetail(order)\">\n        <view class=\"order-header\">\n          <text class=\"order-number\">订单号：{{ order._id }}</text>\n          <text class=\"order-status\" :class=\"getStatusClass(order.status)\">\n            {{ getStatusText(order.status) }}\n          </text>\n        </view>\n        \n        <view class=\"order-content\">\n          <image class=\"car-image\" :src=\"order.car.images[0]\" mode=\"aspectFill\"></image>\n          <view class=\"order-info\">\n            <text class=\"car-name\">{{ order.car.brand }} {{ order.car.model }}</text>\n            <text class=\"customer-name\">客户：{{ order.user.nickname }}</text>\n            <text class=\"service-time\">{{ order.service_date }} {{ order.service_time }}</text>\n            <text class=\"service-location\">{{ order.pickup_location }}</text>\n            <view class=\"order-price\">\n              <text class=\"price-text\">¥{{ order.owner_amount || order.total_amount }}</text>\n              <text class=\"price-note\">(已扣除手续费)</text>\n            </view>\n          </view>\n        </view>\n        \n        <view class=\"order-actions\" v-if=\"order.status !== 4 && order.status !== 5\">\n          <view class=\"action-btn secondary\" @click.stop=\"contactCustomer(order)\">\n            联系客户\n          </view>\n          <view class=\"action-btn secondary\" \n                v-if=\"order.status === 1\"\n                @click.stop=\"rejectOrder(order)\">\n            拒绝\n          </view>\n          <view class=\"action-btn primary\" \n                v-if=\"order.status === 1\"\n                @click.stop=\"confirmOrder(order)\">\n            确认接单\n          </view>\n          <view class=\"action-btn primary\" \n                v-if=\"order.status === 2\"\n                @click.stop=\"startService(order)\">\n            开始服务\n          </view>\n          <view class=\"action-btn primary\" \n                v-if=\"order.status === 3\"\n                @click.stop=\"completeService(order)\">\n            完成服务\n          </view>\n        </view>\n      </view>\n      \n      <!-- 空状态 -->\n      <view class=\"empty-state\" v-if=\"orderList.length === 0 && !loading\">\n        <text class=\"fa fa-list-alt empty-icon\"></text>\n        <text class=\"empty-text\">暂无订单</text>\n      </view>\n      \n      <!-- 加载更多 -->\n      <view class=\"load-more\" v-if=\"hasMore\">\n        <text v-if=\"loading\">加载中...</text>\n        <text v-else @click=\"loadMore\">加载更多</text>\n      </view>\n    </scroll-view>\n  </view>\n</template>\n\n<script lang=\"uts\">\nexport default {\n  data() {\n    return {\n      activeTab: 'pending',\n      orderList: [],\n      loading: false,\n      hasMore: true,\n      page: 1,\n      pendingCount: 3\n    }\n  },\n  onLoad() {\n    this.loadOrderList();\n  },\n  onShow() {\n    this.refreshOrderList();\n  },\n  methods: {\n    switchTab(tab) {\n      this.activeTab = tab;\n      this.refreshOrderList();\n    },\n    async loadOrderList(refresh = false) {\n      if (this.loading) return;\n      \n      this.loading = true;\n      \n      if (refresh) {\n        this.page = 1;\n        this.orderList = [];\n      }\n      \n      try {\n        // 模拟订单数据\n        const mockOrders = [\n          {\n            _id: 'ORDER20250101001',\n            car: {\n              brand: '劳斯莱斯',\n              model: '幻影',\n              images: ['/static/cars/rolls1.jpg']\n            },\n            user: {\n              nickname: '张小明'\n            },\n            service_date: '2025-02-14',\n            service_time: '09:00',\n            pickup_location: '北京市朝阳区三里屯',\n            total_amount: 4000,\n            owner_amount: 3800,\n            status: 1,\n            create_time: '2025-01-15T10:30:00.000Z'\n          },\n          {\n            _id: 'ORDER20250101002',\n            car: {\n              brand: '奔驰',\n              model: 'S级',\n              images: ['/static/cars/benz1.jpg']\n            },\n            user: {\n              nickname: '李小红'\n            },\n            service_date: '2025-01-25',\n            service_time: '14:00',\n            pickup_location: '北京市海淀区中关村',\n            total_amount: 2400,\n            owner_amount: 2280,\n            status: 2,\n            create_time: '2025-01-10T14:20:00.000Z'\n          }\n        ];\n        \n        // 根据状态筛选\n        let filteredOrders = mockOrders;\n        if (this.activeTab !== 'all') {\n          const statusMap = {\n            'pending': 1,\n            'confirmed': 2,\n            'ongoing': 3,\n            'completed': 4\n          };\n          filteredOrders = mockOrders.filter(order => \n            order.status === statusMap[this.activeTab]\n          );\n        }\n        \n        if (refresh) {\n          this.orderList = filteredOrders;\n        } else {\n          this.orderList = [...this.orderList, ...filteredOrders];\n        }\n        \n        this.hasMore = filteredOrders.length === 10;\n        this.page++;\n        \n      } catch (error) {\n        uni.__f__('error','at pages/owner/order-manage.uvue:202','加载订单列表失败:', error);\n        uni.showToast({\n          title: '加载失败',\n          icon: 'none'\n        });\n      }\n      \n      this.loading = false;\n    },\n    refreshOrderList() {\n      this.loadOrderList(true);\n    },\n    loadMore() {\n      if (this.hasMore && !this.loading) {\n        this.loadOrderList();\n      }\n    },\n    getStatusClass(status) {\n      const classMap = {\n        1: 'pending',\n        2: 'confirmed',\n        3: 'ongoing',\n        4: 'completed',\n        5: 'cancelled'\n      };\n      return classMap[status] || '';\n    },\n    getStatusText(status) {\n      const textMap = {\n        1: '待确认',\n        2: '已确认',\n        3: '进行中',\n        4: '已完成',\n        5: '已取消'\n      };\n      return textMap[status] || '';\n    },\n    goToOrderDetail(order) {\n      uni.navigateTo({\n        url: `/pages/order-detail/order-detail?id=${order._id}`\n      });\n    },\n    contactCustomer(order) {\n      uni.showModal({\n        title: '联系客户',\n        content: '是否拨打客户电话？',\n        success: (res) => {\n          if (res.confirm) {\n            uni.makePhoneCall({\n              phoneNumber: '13800138001'\n            });\n          }\n        }\n      });\n    },\n    confirmOrder(order) {\n      uni.showModal({\n        title: '确认接单',\n        content: '确定要接受这个订单吗？',\n        success: (res) => {\n          if (res.confirm) {\n            order.status = 2;\n            this.pendingCount = Math.max(0, this.pendingCount - 1);\n            uni.showToast({\n              title: '已确认接单',\n              icon: 'success'\n            });\n          }\n        }\n      });\n    },\n    rejectOrder(order) {\n      uni.showModal({\n        title: '拒绝订单',\n        content: '确定要拒绝这个订单吗？',\n        success: (res) => {\n          if (res.confirm) {\n            const index = this.orderList.findIndex(item => item._id === order._id);\n            if (index > -1) {\n              this.orderList.splice(index, 1);\n            }\n            this.pendingCount = Math.max(0, this.pendingCount - 1);\n            uni.showToast({\n              title: '已拒绝订单',\n              icon: 'success'\n            });\n          }\n        }\n      });\n    },\n    startService(order) {\n      order.status = 3;\n      uni.showToast({\n        title: '服务已开始',\n        icon: 'success'\n      });\n    },\n    completeService(order) {\n      uni.showModal({\n        title: '完成服务',\n        content: '确定服务已完成吗？完成后将等待客户确认。',\n        success: (res) => {\n          if (res.confirm) {\n            order.status = 4;\n            uni.showToast({\n              title: '服务已完成',\n              icon: 'success'\n            });\n          }\n        }\n      });\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.order-manage-page {\n  background-color: $uni-bg-color-grey;\n  min-height: 100vh;\n}\n\n.status-tabs {\n  background: white;\n  border-bottom: 1px solid $uni-border-color-light;\n  \n  .tabs-container {\n    display: flex;\n    padding: 0 16px;\n    \n    .tab-item {\n      white-space: nowrap;\n      padding: 16px 20px;\n      font-size: 14px;\n      color: $uni-text-color-grey;\n      position: relative;\n      \n      &.active {\n        color: $uni-color-primary;\n        font-weight: 500;\n        \n        &::after {\n          content: '';\n          position: absolute;\n          bottom: 0;\n          left: 50%;\n          transform: translateX(-50%);\n          width: 20px;\n          height: 2px;\n          background: $uni-color-primary;\n          border-radius: 1px;\n        }\n      }\n      \n      .tab-badge {\n        position: absolute;\n        top: 8px;\n        right: 8px;\n        background: $uni-color-error;\n        color: white;\n        font-size: 10px;\n        padding: 2px 6px;\n        border-radius: 10px;\n        min-width: 16px;\n        height: 16px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n    }\n  }\n}\n\n.order-list {\n  flex: 1;\n  padding: 12px 16px;\n  \n  .order-item {\n    background: white;\n    border-radius: 12px;\n    margin-bottom: 12px;\n    padding: 16px;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);\n    \n    .order-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 12px;\n      padding-bottom: 12px;\n      border-bottom: 1px solid $uni-border-color-light;\n      \n      .order-number {\n        font-size: 12px;\n        color: $uni-text-color-grey;\n      }\n      \n      .order-status {\n        font-size: 12px;\n        padding: 2px 8px;\n        border-radius: 10px;\n        \n        &.pending {\n          background: rgba($uni-color-secondary, 0.1);\n          color: $uni-color-secondary;\n        }\n        \n        &.confirmed {\n          background: rgba($uni-color-primary, 0.1);\n          color: $uni-color-primary;\n        }\n        \n        &.ongoing {\n          background: rgba($uni-color-warning, 0.1);\n          color: $uni-color-warning;\n        }\n        \n        &.completed {\n          background: rgba($uni-color-success, 0.1);\n          color: $uni-color-success;\n        }\n        \n        &.cancelled {\n          background: rgba($uni-color-error, 0.1);\n          color: $uni-color-error;\n        }\n      }\n    }\n    \n    .order-content {\n      display: flex;\n      gap: 12px;\n      margin-bottom: 12px;\n      \n      .car-image {\n        width: 80px;\n        height: 80px;\n        border-radius: 8px;\n        flex-shrink: 0;\n      }\n      \n      .order-info {\n        flex: 1;\n        \n        .car-name {\n          font-size: 16px;\n          font-weight: bold;\n          color: $uni-text-color;\n          display: block;\n          margin-bottom: 4px;\n        }\n        \n        .customer-name {\n          font-size: 12px;\n          color: $uni-text-color-grey;\n          display: block;\n          margin-bottom: 4px;\n        }\n        \n        .service-time {\n          font-size: 12px;\n          color: $uni-text-color-grey;\n          display: block;\n          margin-bottom: 4px;\n        }\n        \n        .service-location {\n          font-size: 12px;\n          color: $uni-text-color-grey;\n          display: block;\n          margin-bottom: 8px;\n        }\n        \n        .order-price {\n          display: flex;\n          align-items: baseline;\n          \n          .price-text {\n            font-size: 18px;\n            font-weight: bold;\n            color: $uni-color-primary;\n            margin-right: 4px;\n          }\n          \n          .price-note {\n            font-size: 10px;\n            color: $uni-text-color-grey;\n          }\n        }\n      }\n    }\n    \n    .order-actions {\n      display: flex;\n      justify-content: flex-end;\n      gap: 8px;\n      \n      .action-btn {\n        padding: 6px 16px;\n        border-radius: 16px;\n        font-size: 12px;\n        \n        &.secondary {\n          border: 1px solid $uni-color-primary;\n          color: $uni-color-primary;\n          background: white;\n        }\n        \n        &.primary {\n          background: $uni-color-primary;\n          color: white;\n        }\n      }\n    }\n  }\n}\n\n.empty-state {\n  text-align: center;\n  padding: 60px 20px;\n  \n  .empty-icon {\n    font-size: 48px;\n    color: $uni-text-color-grey;\n    display: block;\n    margin-bottom: 16px;\n  }\n  \n  .empty-text {\n    font-size: 14px;\n    color: $uni-text-color-grey;\n  }\n}\n\n.load-more {\n  text-align: center;\n  padding: 20px;\n  font-size: 14px;\n  color: $uni-text-color-grey;\n}\n</style>\n","import MiniProgramPage from '/Users/admin/Documents/HBuilderProjects/wedding_car/pages/owner/order-manage.uvue'\nwx.createPage(MiniProgramPage)"],"names":["defineComponent","uni"],"mappings":"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"}