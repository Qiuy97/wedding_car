{"code":"import { __awaiter } from \"tslib\";\nimport { defineComponent } from \"vue\";\nexport default defineComponent({\n    data() {\n        return {\n            carId: '',\n            carInfo: new UTSJSONObject({}),\n            ownerInfo: new UTSJSONObject({}),\n            formData: new UTSJSONObject({\n                service_date: '',\n                service_time: '',\n                pickup_location: '',\n                dropoff_location: '',\n                special_requirements: ''\n            }),\n            durationIndex: 0,\n            durationOptions: ['4小时', '6小时', '8小时', '全天(12小时)'],\n            additionalServices: [\n                new UTSJSONObject({\n                    id: 1,\n                    name: '婚车装饰',\n                    description: '鲜花装饰、拉花布置',\n                    price: 200,\n                    selected: false\n                }),\n                new UTSJSONObject({\n                    id: 2,\n                    name: '跟拍服务',\n                    description: '专业摄影师跟拍',\n                    price: 500,\n                    selected: false\n                }),\n                new UTSJSONObject({\n                    id: 3,\n                    name: '迎宾服务',\n                    description: '专业迎宾人员',\n                    price: 300,\n                    selected: false\n                })\n            ]\n        };\n    },\n    computed: {\n        selectedDuration() {\n            return parseInt(this.durationOptions[this.durationIndex]);\n        },\n        baseCost() {\n            return this.carInfo.price_per_hour * this.selectedDuration;\n        },\n        selectedServices() {\n            return this.additionalServices.filter(service => { return service.selected; });\n        },\n        servicesCost() {\n            return this.selectedServices.reduce((total, service) => { return total + service.price; }, 0);\n        },\n        totalCost() {\n            return this.baseCost + this.servicesCost;\n        }\n    },\n    onLoad(options) {\n        this.carId = options.carId;\n        this.loadCarInfo();\n    },\n    methods: {\n        loadCarInfo() {\n            // 模拟数据\n            this.carInfo = new UTSJSONObject({\n                _id: this.carId,\n                brand: '劳斯莱斯',\n                model: '幻影',\n                images: ['/static/cars/rolls1.jpg'],\n                rating: 4.9,\n                price_per_hour: 2000\n            });\n            this.ownerInfo = new UTSJSONObject({\n                nickname: '王师傅',\n                avatar: '/static/avatar/owner1.jpg'\n            });\n        },\n        onDateChange(e = null) {\n            this.formData.service_date = e.detail.value;\n        },\n        onTimeChange(e = null) {\n            this.formData.service_time = e.detail.value;\n        },\n        onDurationChange(e = null) {\n            this.durationIndex = e.detail.value;\n        },\n        selectLocation(type = null) {\n            // 这里应该调用地图选择位置\n            uni.chooseLocation(new UTSJSONObject({\n                success: (res) => {\n                    if (type === 'pickup') {\n                        this.formData.pickup_location = res.address;\n                    }\n                    else {\n                        this.formData.dropoff_location = res.address;\n                    }\n                }\n            }));\n        },\n        toggleService(service = null) {\n            service.selected = !service.selected;\n        },\n        validateForm() {\n            if (!this.formData.service_date) {\n                uni.showToast({\n                    title: '请选择服务日期',\n                    icon: 'none'\n                });\n                return false;\n            }\n            if (!this.formData.service_time) {\n                uni.showToast({\n                    title: '请选择服务时间',\n                    icon: 'none'\n                });\n                return false;\n            }\n            if (!this.formData.pickup_location) {\n                uni.showToast({\n                    title: '请选择接车地点',\n                    icon: 'none'\n                });\n                return false;\n            }\n            if (!this.formData.dropoff_location) {\n                uni.showToast({\n                    title: '请选择送达地点',\n                    icon: 'none'\n                });\n                return false;\n            }\n            return true;\n        },\n        submitBooking() {\n            return __awaiter(this, void 0, void 0, function* () {\n                if (!this.validateForm()) {\n                    return Promise.resolve(null);\n                }\n                uni.showLoading({\n                    title: '创建订单中...'\n                });\n                try {\n                    const orderData = new UTSJSONObject({\n                        car_id: this.carId,\n                        service_date: this.formData.service_date,\n                        service_time: this.formData.service_time,\n                        pickup_location: this.formData.pickup_location,\n                        dropoff_location: this.formData.dropoff_location,\n                        special_requirements: this.formData.special_requirements,\n                        duration: this.selectedDuration,\n                        additional_services: this.selectedServices.map(s => { return s.id; }),\n                        total_amount: this.totalCost\n                    });\n                    // 这里应该调用云函数创建订单\n                    // const res = await uniCloud.callFunction({\n                    //   name: 'order-create',\n                    //   data: orderData\n                    // });\n                    uni.hideLoading();\n                    // 模拟成功创建订单\n                    const orderId = 'order_' + Date.now();\n                    uni.redirectTo({\n                        url: `/pages/payment/payment?orderId=${orderId}&amount=${this.totalCost}`\n                    });\n                }\n                catch (error) {\n                    uni.hideLoading();\n                    uni.__f__('error', 'at pages/booking/booking.uvue:339', '创建订单失败:', error);\n                    uni.showToast({\n                        title: '创建订单失败',\n                        icon: 'none'\n                    });\n                }\n            });\n        }\n    }\n});\n//# sourceMappingURL=/Users/admin/Documents/HBuilderProjects/wedding_car/pages/booking/booking.uvue?vue&type=script&lang.uts.js.map","references":[],"uniExtApis":["uni.chooseLocation","uni.showToast","uni.showLoading","uni.hideLoading","uni.redirectTo","uni.__f__"],"map":"{\"version\":3,\"file\":\"booking.uvue?vue&type=script&lang.uts.js\",\"sourceRoot\":\"\",\"sources\":[\"booking.uvue?vue&type=script&lang.uts\"],\"names\":[],\"mappings\":\"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\"}"}
